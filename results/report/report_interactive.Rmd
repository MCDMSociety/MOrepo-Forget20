---
title: "Examples of lower and upper bound sets"
description: |
  Interactive plots from the paper
author:
  - name: Nicolas Forget
    url: http://pure.au.dk/portal/en/nforget@econ.au.dk
    affiliation: CORAL, BSS, Aarhus University
    affiliation_url: https://econ.au.dk/coral
  - name: Lars Relund Nielsen
    url: http://pure.au.dk/portal/en/larsrn@econ.au.dk
    affiliation: CORAL, BSS, Aarhus University
    affiliation_url: https://econ.au.dk/coral
  - name: Sune Lauth Gadegaard
    url: http://pure.au.dk/portal/en/sgadegaard@econ.au.dk
    affiliation: CORAL, BSS, Aarhus University
    affiliation_url: https://econ.au.dk/coral
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
bibliography: references.bib
citation_url: https://mcdmsociety.github.io/MOrepo-Forget20/report_interactive.html
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,
  output_dir = "../../docs") })
---

```{r, include = FALSE}
library(knitr)
if (interactive()) setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
library(rgl)

if (isTRUE(getOption('knitr.in.progress'))) options(rgl.useNULL=TRUE)
rgl::setupKnitr()
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning=FALSE, message=FALSE, include = TRUE, 
  # cache = TRUE, autodep = TRUE,
  echo=FALSE,
  out.width = "99%", fig.width = 9, fig.align = "center", fig.asp = 1
  # layout="l-screen-inset"   #"l-screen-inset" "l-page"
)
# knit_hooks$set(webgl = hook_webgl, rgl = hook_rgl)
options(knitr.kable.NA = '')
```

```{r setup, include=FALSE}
# remotes::install_github("relund/gMOIP")
library(gMOIP)
library(ggsci)
library(tidyverse)
library(magrittr)
rgl::par3d("family" = "serif")
```

```{r color scales, include=FALSE}
# https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html
mypal <- pal_npg("nrc", alpha = 0.7)(9)
mypal <- pal_simpsons()(9)
# mypal
library("scales")
show_col(mypal)
```

Interactive plots that can be rotated and zoomed with the mouse.

## Figure 3b

```{r}
ubSet <- matrix( c(1,1,1), ncol = 3, byrow = TRUE)
row.names(ubSet) <- paste0("z", 1)
lim <- c(0,7)  # bounding box for problem
m <- rep(lim[1],3)
M <-rep(lim[2],3)
augment <- function(idx, a, b, prefix = "") {
  res <- NULL
  for (i in idx) {
    c <- b
    c[i] <- a[i]
    res <- rbind(res,c)
  }
  row.names(res) <- paste0(prefix,idx)
  return(res)
}
zHat <- augment(1:3, M, m)
# iteration 0
U <- matrix(M, ncol = 3, byrow = T)
row.names(U) <- "u0"
N <- NULL
NHat <- rbind(N,zHat)
z <- ubSet[1,1:3]
u0 <- M
U <- augment(1:3, z, u0, "u")
N<- rbind(N, ubSet[1,1:3, drop=F])

view <- matrix( c(-0.640044808387756, -0.205455526709557, 0.740358412265778, 0, 0.767741799354553, -0.208960145711899, 0.605729579925537, 0, 0.0302549730986357, 0.956098079681396, 0.29148057103157, 0, 0, 0, 0, 1), nc = 4)

# rgl::mfrow3d(nr = 1, nc = 2, sharedMouse = F)

lim <- c(lim[1]-0.05,lim[2]+0.05)
## First plot
# ini3D(argsPlot3d = list(xlim = lim, ylim = lim, zlim = lim))
# # plotRectangle3D(m,M)
# plotPoints3D(N, addText = "coord", argsPlot3d = list(type="p", col = "black", size = 8))
# plotPoints3D(U, addText = "coord", argsPlot3d = list(type="p", col = mypal[3], size = 8), argsText3d = list(col = "blue", adj = c(1,1)))
# plotPlane3D(c(1,1,1), point = c(2,2,2), argsLines = list(col = mypal[2], lines = 50), useLines = T, useShade = F)
# plotPlane3D(c(1,1,1), point = c(2,2,2), argsPlanes3d = list(alpha = 0.7, col = mypal[8]))
# plotCones3D(U[1:3,], drawPoint = F, argsPolygon3d = list(alpha =0.3, color = mypal[1]), rectangle = F, direction = -1, drawLines = F)
# finalize3D(argsAxes3d = list(edges = "bbox", box = F))
# loadView(v = view, clear = FALSE, zoom = 0.7)
# rglwidget()

## all relevant points for drawing search areas
vtx <- matrix(c(
  1,1,4,
  1,4,1,
  4,1,1,
  0,0,7,
  0,7,0,
  7,0,0,
  0,0,6,
  0,6,0,
  6,0,0,
  0,1,5,
  0,5,1,
  1,0,5,
  1,5,0,
  5,0,1,
  5,1,0,
  1,1,7,
  1,7,1,
  7,1,1,
  7,1,0,
  7,0,1,
  1,7,0,
  1,0,7,
  0,7,1,
  0,1,7,
  7,7,0,
  7,0,7,
  0,7,7,
  7,1,7,
  7,7,1,
  1,7,7
), ncol = 3, byrow = T)
vtx <- vtx %>% set_colnames(c("x", "y", "z")) %>% as_tibble() %>% arrange(x,y,z)
# plotPoints3D(vtx, addText = "coord")
# print(vtx, n=100)


ini3D(argsPlot3d = list(xlim = lim, ylim = lim, zlim = lim))
# Points
plotPoints3D(N, argsPlot3d = list(type="p", col = "black", size = 10))
plotPoints3D(U, argsPlot3d = list(type="p", col = mypal[8], size = 10), argsText3d = list(col = "blue", adj = c(1,1)))
# plotCones3D(c(1,1,1), argsPolygon3d = list(alpha = 0.9, color = mypal[4]))
# Plane
plotPlane3D(c(1,1,1), point = c(2,2,2), argsPlanes3d = list(alpha = 0.75, col = mypal[2]))
plotPlane3D(c(1,1,1), point = c(2,2,2), argsLines = list(col = "black", lines = 100, alpha = 0.75), useLines = T, useShade = F)
# Overlapping areas
args <- list(color = mypal[5], alpha = 0.9)
plotHull3D(vtx[c(19:24,26:27),], drawPolygons = T, argsPolygon3d = args)
vtx <- vtx %>% arrange(y,x,z)
plotHull3D(vtx[c(19:24,26:27),], drawPolygons = T, argsPolygon3d = args)
vtx <- vtx %>% arrange(z,y,x)
plotHull3D(vtx[c(19:24,26:27),], drawPolygons = T, argsPolygon3d = args)
# Non-overlapping areas
args <- list(color = mypal[3], alpha = 0.4)
plotHull3D(vtx[c(10,11,12,13,19,20,24,25,27,28),] , drawPolygons = T, argsPolygon3d = args)
vtx <- vtx %>% arrange(y,x,z)
plotHull3D(vtx[c(10,11,12,13,19,20,24,25,27,28),] , drawPolygons = T, argsPolygon3d = args)
vtx <- vtx %>% arrange(y,z,x)
plotHull3D(vtx[c(10,11,12,13,19,20,24,25,27,28),] , drawPolygons = T, argsPolygon3d = args)
finalize3D(argsAxes3d = list(edges = c("x", "y", "z"), box = F, labels=FALSE, tick=FALSE))
# finalize3D(argsAxes3d = list(edges = "bbox"))
#axes3d(edges=c("x", "y", "z"), col='black', box=FALSE, labels=FALSE, tick=FALSE)
#rgl.bbox(xlab = "", ylab = "", zlab = "")
view <- matrix( c(-0.601261854171753, -0.375613540410995, 0.705264508724213, 0, 0.79587709903717, -0.36011865735054, 0.48671817779541, 0, 0.071161076426506, 0.853949129581451, 0.515467822551727, 0, 0, 0, 0, 1), nc = 4)
loadView(v = view, clear = F, zoom = 0.8)
rglwidget()
# saveView(print=TRUE)
```





## Figure 4

```{r}
# pts <- genNDSet(3, 50, argsSphere = list(below = NULL, closeToPlane = T, center = c(2,2,2), radius = 5), dubND = F)
# save(pts, file = "pts_fig4.Rdata")
load("pts_fig4.Rdata")

## First plot
# open3d()
# rgl::mfrow3d(nr = 1, nc = 2, sharedMouse = F)
ini3D(argsPlot3d = list(xlim = c(min(pts$z1)-2,max(pts$z1)+10), 
                        ylim = c(min(pts$z2)-2,max(pts$z2)+10), 
                        zlim = c(min(pts$z3)-2,max(pts$z3)+10)))
lub <- Rfast::colMinsMaxs(as.matrix(pts[,1:3]))[2,]
M <- rgl::par3d()$bbox
lub <- rbind(lub, c(M[2],M[4],M[6])-0.01)
llb <- c(M[1],M[3],M[5])+ 0.01
# plotPoints3D(pts)
plotCones3D(pts[pts$nd,c("z1","z2","z3")], argsPolygon3d = list(alpha = 1, color = mypal[8]), drawPoint = T, rectangle = T, argsPlot3d = list(size = 10))
plotCones3D(lub[2,], direction = -1, argsPolygon3d = list(alpha = 0.4, color = mypal[1]), drawPoint = F)
# plotHull3D(unique(pts))
plotPlane3D(c(1,1,1), point = c(3,3,3), argsPlanes3d = list(alpha = 0.6, col = mypal[7]))
root <- currentSubscene3d()
newSubscene3d(
  "inherit",
  "inherit",
  "inherit",
  copyShapes = T,
  copyBBoxDeco = F,
  parent = root
)
plotCones3D(llb, argsPolygon3d = list(alpha = 0.75, color = mypal[3]), drawPoint = F)
# plotHull3D(unique(pts))
clipplanes3d(1, 1, 1, -9)
useSubscene3d(root)
# axes3d()
finalize3D(argsAxes3d = list(edges = "bbox"), argsTitle3d = list(xlab = "", ylab = "", zlab = ""))
# saveView(print = T)
view <- matrix( c(0.710081100463867, -0.417695313692093, -0.566847920417786, 0, -0.695306360721588, -0.288975149393082, -0.658059477806091, 0, 0.111063443124294, 0.861408114433289, -0.495621830224991, 0, 0, 0, 0, 1), nc = 4)
loadView(v = view, clear = FALSE, zoom = 0.7)
rglwidget()
```


```{r}
## Second plot
ini3D(clear = T, argsPlot3d = list(xlim = c(min(pts$z1)-2,max(pts$z1)+10), 
                        ylim = c(min(pts$z2)-2,max(pts$z2)+10), 
                        zlim = c(min(pts$z3)-2,max(pts$z3)+10)))
# plotPoints3D(pts)
plotPlane3D(c(1,1,1), point = c(3,3,3), argsPlanes3d = list(alpha = 0.6, col = mypal[7]))
plotCones3D(lub, direction = -1, argsPolygon3d = list(alpha = 1, color = mypal[1]), drawPoint = T)
plotmath3d(lub-1, text = expression(y^1, y^2), cex = 1.2, font = 3)
root <- currentSubscene3d()
newSubscene3d(
  "inherit",
  "inherit",
  "inherit",
  copyShapes = T,
  copyBBoxDeco = F,
  parent = root
)
plotCones3D(llb, argsPolygon3d = list(alpha = 0.75, color = mypal[3]), drawPoint = F)
# plotHull3D(unique(pts))
clipplanes3d(1, 1, 1, -9)
newSubscene3d(
  "inherit",
  "inherit",
  "inherit",
  copyShapes = T,
  copyBBoxDeco = F,
  parent = root
)
plotCones3D(pts[pts$nd,c("z1","z2","z3")], argsPolygon3d = list(alpha = 1, color = mypal[8]), drawPoint = T, drawLines = T, argsPlot3d = list(size = 10))
clipplanes3d(-1, -1, -1, 9)
useSubscene3d(root)
# axes3d()
finalize3D(argsAxes3d = list(edges = "bbox"))
view <- matrix( c(0.860876560211182, -0.30657571554184, -0.406083613634109, 0, -0.448700070381165, -0.081096462905407, -0.889995634555817, 0, 0.239919260144234, 0.948385238647461, -0.207374647259712, 0, 0, 0, 0, 1), nc = 4)
loadView(v = view, clear = FALSE, zoom = 0.7)
rglwidget()
```






















